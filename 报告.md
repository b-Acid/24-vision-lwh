![img](https://i0.hdslb.com/bfs/new_dyn/791944995fff725f42c7f5a9b64f8567100423098.png@1295w.webp)

# 华南虎视觉组实习生任务

实习生姓名：刘玮涵

## 一、公共任务

### 装甲板识别

#### 1. 代码思路
1. 对图像进行通道分离，分为BGR三个通道。
2. 按探测颜色对对应通道的图像进行二值化。
3. 对图像进行高斯滤波，减少噪点。
4. 用cv::dilate()进行膨胀，使轮廓边缘圆滑。
5. 使用漫水法使图像平滑。
6. 调用cv::findContours()进行轮廓检测。
7. 对每个轮廓做最小外接矩形，筛除不符合灯柱形状要求的矩形。轮廓要进一步简化为线段，取得到的矩形的较短两边灯柱两个中心作为轮廓的两个端点。
8. 对所有轮廓两两匹配，按照预设参数匹配两个轮廓是否组成装甲板。
9. 标记匹配成功的装甲板，用pnp算法，cv::solvepnp()结算其相对相机的坐标，即可得到位姿。

#### 2. 遇到问题和解决思路
> 1. 探测到的灯管长方形四个点无法定序。灯管的1~4号端点的顺序在opencv里默认是以离原点最近的为1号然后顺时针一圈排列四个点，但是离原点最近的那个点因为装甲板的方位会比较随机，导致4个点无法定序。


__解决方式__：   
+ 在灯管类的初始化时分别计算灯管长方形的四条边的中心和整个长方形的中心坐标，然后计算哪两个边中心离形心更远，就拿这两个边中心作为轮廓线段的端点。y坐标小的为0号端点，y坐标大的为1号端点。虽然这个方法在装甲板是竖着的时候不适用，但99%的识别任务中装甲板是横的。这样处理后就不用管点的定序问题了，而且识别到的装甲板永远以左灯柱的上端点为1号端点然后顺时针一周排布4个端点。

> 2. 实测发现最小外接矩形法很不稳定，因为它真的就是找最小外接矩形，套出来的外接矩形会因为图形边缘的不稳定左右晃动

__解决方式__：  
+ 改进为把轮廓作为椭圆形轮廓，利用cv::fitEllipse()来给灯管矩形

> 3. 虽然cv::findContours()的输出轮廓是无序的，但是轮廓两两匹配确实简单粗暴，比较耗时。

__解决方式__：  
+ 改进方案为对每个轮廓按x坐标排序，每个轮廓只和左右三个轮廓匹配一次  。

+ _10.05记：对每个轮廓排序也是个不小时间开支，因为排序涉及到对内存区域交换、开新空间的操作，两两匹配可能是最优的方法了_。


#### 3. 效果图
+ ![装甲板效果图](https://github.com/b-Acid/24-vision-lwh/blob/main/%E8%A3%85%E7%94%B2%E6%9D%BF%E8%AF%86%E5%88%AB/output.png?raw=true)

#### 4. 总结
+ 本任务中我熟悉了opencv中一些对图像的基本处理方法，比如Mat类的基本操作，图像通道分离，二值化图像，高斯滤波，图形膨胀，漫水法，轮廓检测等等。另外呢学到了pnp算法，了解了二位像素坐标和世界坐标的转换关系，实现了基于拍摄图和实物参数结算相机姿态的操作。





## 二、专属方向（此处填写专属方向）任务

1. 代码思路
2. 遇到问题
3. 解决思路
4. 效果图
5. 总结

## 三、总结



运行效果地址：

git仓库地址：